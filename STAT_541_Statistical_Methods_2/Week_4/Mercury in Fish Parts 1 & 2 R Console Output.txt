> # Note the name for the imported Excel file
> str(Mercury_in_Fish)
Classes ‘tbl_df’, ‘tbl’ and 'data.frame':	53 obs. of  6 variables:
 $ Lake: num  1 2 3 4 5 6 7 8 9 10 ...
 $ EHg : num  1.53 1.33 0.04 0.44 1.33 0.25 0.45 0.16 0.72 0.81 ...
 $ Alk : num  5.9 3.5 116 39.4 2.5 19.6 5.2 71.4 26.4 4.8 ...
 $ pH  : num  6.1 5.1 9.1 6.9 4.6 7.3 5.4 8.1 5.8 6.4 ...
 $ Ca  : num  3 1.9 44.1 16.4 2.9 4.5 2.8 55.2 9.2 4.6 ...
 $ Chlo: num  0.7 3.2 128.3 3.5 1.8 ...
> # To have most of our R code reuseable for future 
> #  analyses, we will use a data object called dataobj
> dataobj <- as.data.frame(Mercury_in_Fish)
> str(dataobj)
'data.frame':	53 obs. of  6 variables:
 $ Lake: num  1 2 3 4 5 6 7 8 9 10 ...
 $ EHg : num  1.53 1.33 0.04 0.44 1.33 0.25 0.45 0.16 0.72 0.81 ...
 $ Alk : num  5.9 3.5 116 39.4 2.5 19.6 5.2 71.4 26.4 4.8 ...
 $ pH  : num  6.1 5.1 9.1 6.9 4.6 7.3 5.4 8.1 5.8 6.4 ...
 $ Ca  : num  3 1.9 44.1 16.4 2.9 4.5 2.8 55.2 9.2 4.6 ...
 $ Chlo: num  0.7 3.2 128.3 3.5 1.8 ...
> par(mfrow = c(1, 1)) 
> # examine scatterplot matrix of dependent and independent variables
> #  use columns 2,3,4,5,6 in dataset
> plot(dataobj[,2:6],main="Mercury in Fish")
> # correlation matrix with p-values
> #  correlation matrix is first, then n, then p-values for each
> #    pairwise correlation
> library(ggplot2)
> library(Hmisc)
> mat <- as.matrix(dataobj[,2:6])
> rcorr(mat, type="pearson")
       EHg   Alk    pH    Ca  Chlo
EHg   1.00 -0.63 -0.61 -0.46 -0.51
Alk  -0.63  1.00  0.72  0.83  0.48
pH   -0.61  0.72  1.00  0.58  0.61
Ca   -0.46  0.83  0.58  1.00  0.41
Chlo -0.51  0.48  0.61  0.41  1.00

n= 53 


P
     EHg    Alk    pH     Ca     Chlo  
EHg         0.0000 0.0000 0.0005 0.0001
Alk  0.0000        0.0000 0.0000 0.0003
pH   0.0000 0.0000        0.0000 0.0000
Ca   0.0005 0.0000 0.0000        0.0023
Chlo 0.0001 0.0003 0.0000 0.0023       
> # multiple regression model
> model <- lm(EHg ~ Alk + pH + Ca + Chlo, data=dataobj)
> summary(model)

Call:
lm(formula = EHg ~ Alk + pH + Ca + Chlo, data = dataobj)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40447 -0.16668 -0.03927  0.09110  0.83958 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.062482   0.248941   4.268 9.24e-05 ***
Alk         -0.004697   0.001960  -2.396   0.0205 *  
pH          -0.057426   0.043812  -1.311   0.1962    
Ca           0.002485   0.002559   0.971   0.3365    
Chlo        -0.002149   0.001447  -1.485   0.1440    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.2541 on 48 degrees of freedom
Multiple R-squared:  0.4806,	Adjusted R-squared:  0.4373 
F-statistic:  11.1 on 4 and 48 DF,  p-value: 1.86e-06

> # confidence intervals on model parameters
> confint(model,level=0.95)
                   2.5 %        97.5 %
(Intercept)  0.561953078  1.5630111032
Alk         -0.008638802 -0.0007560003
pH          -0.145515897  0.0306631147
Ca          -0.002661189  0.0076311529
Chlo        -0.005058051  0.0007599943
> # confidence interval on E(y) for specified values of all 
> #   independent variables
> forecastdata = data.frame(Alk=80,
+                           pH=7,
+                           Ca=40,
+                           Chlo=25) 
> predict(model,newdata=forecastdata,interval="confidence")
        fit       lwr       upr
1 0.3303788 0.2090822 0.4516754
> # prediction interval on y for specified values of all 
> #   independent variables
> predict(model,newdata=forecastdata,interval="prediction")
        fit       lwr       upr
1 0.3303788 -0.194689 0.8554466
> par(mfrow = c(2, 2))
> plot(model, main="Mercury in Fish")
> # Shapiro-Wilk test for normality of errors and use alpha=0.01
> shapiro.test(resid(model))

	Shapiro-Wilk normality test

data:  resid(model)
W = 0.91693, p-value = 0.001286

> # Breusch-Pagan Test for a common error variance and use alpha=0.01
> bptest(model)

	studentized Breusch-Pagan test

data:  model
BP = 3.8921, df = 4, p-value = 0.4208

> par(mfrow = c(1, 1))
> # histogram of residuals
> hist(resid(model), main="Histogram of Residuals",xlab="Residuals")
> # boxplot of residuals
> boxplot(resid(model), main="Boxplot of Residuals")
> # Influential observations
> influence.measures(model)
Influence measures of
	 lm(formula = EHg ~ Alk + pH + Ca + Chlo, data = dataobj) :

     dfb.1_   dfb.Alk   dfb.pH    dfb.Ca  dfb.Chlo   dffit cov.r   cook.d    hat inf
1  -0.12557 -0.238272  0.27932 -0.052702 -0.304102  0.7829 0.299 9.55e-02 0.0403   *
2   0.33964  0.024144 -0.24872 -0.061864  0.030844  0.5350 0.638 5.18e-02 0.0455   *
3   0.07333  0.280191 -0.11629 -0.268444  0.469166  0.6591 1.439 8.69e-02 0.3044   *
4   0.01965 -0.010041 -0.02754  0.017829  0.039938 -0.0623 1.149 7.92e-04 0.0424    
5   0.50604  0.083766 -0.42254 -0.035514  0.098696  0.6215 0.700 7.09e-02 0.0681    
6   0.08793  0.060376 -0.11156  0.067862 -0.070520 -0.2338 1.095 1.10e-02 0.0654    
7  -0.10223  0.009432  0.06076  0.024373  0.011098 -0.2194 1.012 9.58e-03 0.0372    
8   0.09350  0.074575 -0.09562 -0.110365  0.052086 -0.1919 1.143 7.45e-03 0.0741    
9   0.03123  0.029077 -0.02009 -0.027457 -0.021195  0.0726 1.135 1.07e-03 0.0356    
10 -0.02841 -0.076202  0.05305  0.004162  0.016247  0.1467 1.102 4.35e-03 0.0423    
11  0.00677  0.000152 -0.00493 -0.001921  0.003149  0.0113 1.157 2.62e-05 0.0402    
12  0.06870  0.054866 -0.08218 -0.017846  0.054860 -0.1034 1.190 2.18e-03 0.0785    
13  0.01721  0.018771 -0.02052 -0.012581  0.012801 -0.0288 1.185 1.69e-04 0.0639    
14  0.03916 -0.054544  0.00558 -0.004484 -0.034291  0.2216 0.982 9.72e-03 0.0319    
15 -0.03415 -0.024987  0.04080 -0.024079 -0.028134 -0.0818 1.393 1.37e-03 0.2047   *
16  0.00419  0.020758 -0.00103 -0.037221 -0.033097 -0.0685 1.257 9.58e-04 0.1196    
17  0.00649  0.288249 -0.02698 -0.270872  0.161391  0.4392 1.223 3.87e-02 0.1748    
18 -0.03578 -0.038979  0.03827  0.053183 -0.036735  0.0759 1.251 1.18e-03 0.1158    
19  0.03647 -0.053148  0.01199 -0.014927 -0.044371  0.2386 0.965 1.12e-02 0.0330    
20 -0.01827 -0.003823  0.03510 -0.021587 -0.025880  0.1034 1.087 2.16e-03 0.0238    
21 -0.37941 -0.130226  0.33841  0.077551 -0.136736 -0.4168 1.032 3.43e-02 0.0950    
22  0.00431  0.004057 -0.00602 -0.000227  0.003996 -0.0101 1.156 2.09e-05 0.0390    
23 -0.02816  0.013039  0.00223  0.042590 -0.030850 -0.1479 1.067 4.40e-03 0.0311    
24 -0.09370 -0.137885  0.12493  0.013368  0.037209  0.2341 1.078 1.10e-02 0.0594    
25 -0.09825  0.001564  0.05722  0.016975  0.035321 -0.2189 0.998 9.52e-03 0.0342    
26 -0.00349 -0.001424  0.00514 -0.002388 -0.001792  0.0109 1.142 2.42e-05 0.0276    
27  0.00817 -0.030986 -0.01191  0.038143  0.010272 -0.0556 1.165 6.32e-04 0.0518    
28  0.09457  0.019640 -0.08197 -0.008390  0.030205  0.1086 1.189 2.40e-03 0.0792    
29 -0.21510 -0.049611  0.18442  0.044863 -0.099451 -0.2586 1.085 1.34e-02 0.0688    
30 -0.01877  0.034558 -0.01798  0.016016  0.053569 -0.1809 1.048 6.56e-03 0.0352    
31  0.03315  0.060616 -0.03328 -0.089712 -0.001958 -0.1216 1.186 3.01e-03 0.0800    
32  0.02202  0.008681 -0.02684  0.012414 -0.000177 -0.0429 1.164 3.76e-04 0.0490    
33  0.08250  0.031516 -0.07626 -0.012494  0.026059  0.0856 1.332 1.49e-03 0.1690   *
34 -0.24853 -0.077306  0.21625  0.045739 -0.063069 -0.2826 1.111 1.60e-02 0.0858    
35  0.00800  0.100951 -0.01025 -0.070006 -0.038242  0.1184 1.424 2.86e-03 0.2240   *
36  0.05637  0.046085 -0.08362  0.083277 -0.119475 -0.2771 1.000 1.52e-02 0.0492    
37 -0.08715 -0.005892  0.09814 -0.203665  0.064370 -0.3224 1.394 2.11e-02 0.2317   *
38 -0.01473  0.111178  0.02574 -0.070207 -0.314867 -0.3570 1.955 2.59e-02 0.4414   *
39  0.02436  0.018193 -0.03063  0.004179  0.012568 -0.0423 1.187 3.65e-04 0.0665    
40 -0.09386 -0.399439  0.07698  0.941365 -0.318762  1.1464 0.815 2.41e-01 0.1994   *
41 -0.06085 -0.097886  0.06771 -0.045051  0.084275 -0.2230 1.318 1.01e-02 0.1772   *
42 -0.06644 -0.152456  0.06797  0.053935  0.071730 -0.2012 1.243 8.22e-03 0.1310    
43 -0.00398  0.186630 -0.03513 -0.195709  0.083636 -0.2884 1.024 1.65e-02 0.0582    
44  0.01066 -0.007275 -0.01074  0.015782 -0.016589 -0.0383 1.208 2.99e-04 0.0820    
45 -0.00636 -0.023889  0.00825  0.023804 -0.000894  0.0277 1.281 1.56e-04 0.1335    
46  0.03708  0.165990 -0.06199 -0.143253  0.033516 -0.2011 1.143 8.17e-03 0.0769    
47 -0.08963  0.057610  0.09458 -0.081123 -0.088272  0.1586 1.385 5.13e-03 0.2061   *
48  0.20804  0.042564 -0.18233 -0.016129  0.069963  0.2343 1.156 1.11e-02 0.0924    
49  0.08243 -0.006790 -0.10774  0.053245  0.115081 -0.1899 1.078 7.25e-03 0.0467    
50  0.05970  0.039867 -0.07916  0.023336  0.028907 -0.1248 1.127 3.16e-03 0.0467    
51  0.00576  0.000922 -0.00375 -0.003137  0.005428  0.0142 1.140 4.09e-05 0.0258    
52 -0.27498 -0.170735  0.22178  0.154339  0.000280 -0.3894 0.880 2.92e-02 0.0519    
53  0.02845 -0.040312 -0.03190  0.044682  0.042672 -0.0790 1.246 1.27e-03 0.1128    
> # Check for multicollinearity
> # The VIF function is in R package regclass
> VIF(model)
     Alk       pH       Ca     Chlo 
4.517506 2.566691 3.280146 1.601203 
>